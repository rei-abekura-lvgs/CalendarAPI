# 暦データAPI 仕様書

## プロジェクト概要

**プロジェクト名**: 暦データAPI (Calendar Data API)  
**開発期間**: 2025年6月20日〜23日  
**対象年**: 2025年〜2036年（12年分）  
**総データ量**: 4383日分  
**データ項目数**: 39項目  
**対応形式**: JSON, CSV, XML, TXT  

## ユーザー要求仕様

### 1. 基本要求事項
- 日本語でのコミュニケーション
- JSON APIとして直接URLアクセス可能な形式
- ドキュメントサイトは必須ではない（後に追加）
- 色はカラーコードではなく日本語の色名
- キーワードはより気の利いた心に響く表現
- 1ヶ月分のデータを一覧表示できる機能

### 2. データ内容要求
#### 基本データ
- 日付情報（年月日、曜日）
- 日本の祝日（祝日名含む）
- 六曜（大安、友引など）
- 週末判定

#### 拡張データ（スピリチュアル・文化要素）
- 日々のキーワード（スピリチュアルで面白い表現）
- おすすめお茶
- 曜日カラー（日本語色名）
- ラッキーナンバー
- パワーストーン
- アロマオイル
- 瞑想テーマ
- 花言葉
- エネルギーアドバイス
- 占星術
- タロットカード
- 名言
- 音楽推奨
- 食事推奨
- クリスタルヒーリング
- 風水アドバイス

#### 特別機能
- 一粒万倍日（28項目目として追加）
- 十干十二支（29項目目として追加）
- 四柱推命データ（30〜39項目目として追加）
  - 十干・十二支の五行属性
  - 陰陽属性
  - 十二支の動物
  - 十二運（運勢段階）
  - 空亡（天中殺）判定・種類・影響範囲

### 3. 技術要求
- 静的ホスティング（GitHub Pages）
- 複数形式対応（JSON、CSV、XML、TXT）
- 文字化け問題の解決
- UTF-8エンコーディング対応
- 12年分データの完全生成

### 4. 機能拡張要求
- 検索機能（キーワード、六曜、祝日、パワーストーン等）
- 運勢機能（27→29項目統合）
- レスポンシブデザイン
- デザイン統一化
- ナビゲーション改善

## 実装仕様

### データ構造

#### JSON形式（月別）
```json
{
  "year": 2025,
  "month": 6,
  "month_name": "June", 
  "month_name_jp": "6月",
  "api_version": "v1",
  "generated_at": "2025-06-23T...",
  "days": [
    {
      "day": 1,
      "date": "2025-06-01",
      "weekday": "日曜日",
      "weekday_en": "Sunday",
      "weekday_short": "Sun",
      "is_weekend": true,
      "is_holiday": false,
      "holiday_name": null,
      "rokuyo": "赤口",
      "is_ichiryu_manbai": false,
      "jikkan_junishi": "丁酉",
      "season_24": null,
      "moon_phase": "調査中",
      "daily_keyword": "宇宙からのメッセージ",
      "color_of_the_day": "青色",
      "recommended_tea": "緑茶",
      "lucky_number": 7,
      "power_stone": "アメジスト",
      "aroma_oil": "ラベンダー",
      "meditation_theme": "マインドフルネス",
      "flower_of_the_day": "バラ - 愛",
      "energy_advice": "新しい始まりを受け入れる",
      "zodiac_influence": "牡羊座",
      "tarot_card": "愚者 - 新しい始まり",
      "wise_quote": "一歩一歩が大切な旅路",
      "recommended_music": "クラシック",
      "recommended_food": "季節の野菜スープ",
      "crystal_healing": "アメジスト - 心の浄化",
      "feng_shui_tip": "玄関を清潔に保つ"
    }
  ]
}
```

### API エンドポイント

#### 月別データ
- `api/2025/01.json` 〜 `api/2025/12.json`
- `api/2026/01.json` 〜 `api/2026/12.json`
- ...
- `api/2036/01.json` 〜 `api/2036/12.json`

#### 年間データ
- `api/2025/all.json` 〜 `api/2036/all.json`

#### 複数形式
各月・年間データは以下の形式で提供：
- `.json` - プログラム用
- `.csv` - Excel・データ分析用
- `.xml` - システム統合用
- `.txt` - 人間が読みやすい形式

### 特別機能

#### 1. 一粒万倍日計算
- 伝統的な干支組み合わせに基づく
- 各年約79日の一粒万倍日
- 月ごとのパターン定義

#### 2. 十干十二支計算
- 1900年1月1日を基準日とする60日周期計算
- 十干：甲乙丙丁戊己庚辛壬癸
- 十二支：子丑寅卯辰巳午未申酉戌亥

#### 3. 四柱推命データ
- **十干五行**: 甲乙(木)、丙丁(火)、戊己(土)、庚辛(金)、壬癸(水)
- **十二支五行**: 子亥(水)、寅卯(木)、巳午(火)、申酉(金)、辰戌丑未(土)
- **陰陽**: 十干の陰陽属性（甲丙戊庚壬=陽、乙丁己辛癸=陰）
- **十二支動物**: 子(鼠)丑(牛)寅(虎)卯(兎)辰(龍)巳(蛇)午(馬)未(羊)申(猿)酉(鶏)戌(犬)亥(猪)
- **十二運**: 長生・沐浴・冠帯・建禄・帝旺・衰・病・死・墓・絶・胎・養
- **空亡(天中殺)**: 60日周期で正確計算、5種類×影響範囲

#### 4. 空亡（天中殺）計算
- **戌亥空亡**: 家庭・不動産への影響
- **申酉空亡**: 友人・兄弟への影響
- **午未空亡**: 配偶者・恋愛への影響
- **辰巳空亡**: 財運・社会への影響
- **寅卯空亡**: 親・目上への影響

#### 5. 検索機能
- 12年分データ対応
- 年選択機能
- 統合検索（39項目横断）
- 特別検索（一粒万倍日、週末、祝日、空亡）

#### 6. 運勢機能
- 39項目統合の総合運勢計算
- 恋愛運、金運、健康運、仕事運
- 週間運勢
- 相性診断

## 技術実装詳細

### 開発環境
- **プラットフォーム**: Replit
- **言語**: Python 3.11+
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+)
- **フレームワーク**: Bootstrap 5.3.0
- **開発サーバー**: UTF-8対応HTTPサーバー（utf8_server.py）

### ファイル構成
```
/
├── api/
│   ├── 2025/
│   │   ├── 01.json, 01.csv, 01.xml, 01.txt
│   │   ├── ...
│   │   ├── 12.json, 12.csv, 12.xml, 12.txt
│   │   └── all.json, all.csv, all.xml, all.txt
│   ├── 2026/ 〜 2036/ (同様の構成)
├── js/
│   ├── app.js (メイン機能)
│   ├── search-api.js (検索機能)
│   └── fortune-api.js (運勢機能)
├── css/
│   └── style.css
├── index.html (メインページ)
├── search.html (検索ページ)
├── api_index.html (データ一覧)
├── generate_data.py (データ生成)
├── generate_formats.py (形式変換)
└── utf8_server.py (開発サーバー)
```

### データ生成プロセス
1. **generate_data.py**: 12年分JSONデータ生成
2. **generate_formats.py**: CSV/XML/TXT形式変換
3. **文字エンコーディング**: 全ファイルUTF-8対応
4. **品質保証**: comprehensive_final_test.py で全エンドポイント検証

## 品質保証・テスト

### テスト項目
- 全52エンドポイント動作確認
- 文字エンコーディング検証
- データ完全性検証
- 検索機能テスト
- レスポンシブデザイン確認

### パフォーマンス
- 静的ファイル配信
- キャッシュ対応
- モバイル最適化

## プロジェクト履歴

### 主要マイルストーン
- **6月20日**: 基本API完成、データ品質向上
- **6月20日**: 複数形式対応、データ種類大幅拡張（19→27項目）
- **6月21日**: 12年分データ生成、UI改善、品質保証完備
- **6月23日**: 一粒万倍日追加（28項目）、12年分検索機能
- **6月23日**: 十干十二支追加（29項目）、デザイン統一化

### 技術的課題と解決
1. **文字化け問題**: UTF-8対応HTTPサーバー実装
2. **GitHub Pages 404**: 環境自動判定とテスト環境整備
3. **JavaScript依存性**: 直接データアクセス方式採用
4. **検索機能**: 12年分対応と年選択機能実装

## 今後の拡張可能性

### 提案された機能拡張
- 二十四節気の正確な実装
- 月の満ち欠け情報
- より詳細な占星術データ
- API認証機能
- データ分析ダッシュボード
- モバイルアプリ連携

## 利用ガイド

### 基本的な使用方法
1. **Webブラウザ**: `index.html` からドキュメント確認
2. **API直接アクセス**: `api/2025/01.json` 等のURL
3. **検索機能**: `search.html` でキーワード・年指定検索
4. **データ一覧**: `api_index.html` で全ファイル確認

### 開発者向け
- CORS対応済み
- 認証不要
- 全データ形式対応
- レスポンシブAPI設計

---

**最終更新**: 2025年6月23日  
**API バージョン**: v1  
**データ項目数**: 29項目  
**対応年数**: 12年分 (2025-2036)